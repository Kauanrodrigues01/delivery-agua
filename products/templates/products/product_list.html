{% extends 'base.html' %}

{% load static %}
{% load compress %}

{% block title %}Produtos{% endblock %}

{% block head %}
    {% compress css %}
    <link rel="stylesheet" href="{% static 'products/styles.css' %}">
    <link rel="stylesheet" href="{% static 'global/form-default-style.css' %}">
    <link rel="stylesheet" href="{% static 'global/buttons-default-style.css' %}">
    <link rel="stylesheet" href="{% static 'components/pagination/pagination.css' %}">
    {% endcompress %}
{% endblock %}

{% block content %}
<main class="main-content">
    <div class="container">
        <!-- Hero Section -->
        <section class="hero-section">
            <h2>Nossos Produtos</h2>
            <!-- <p>
                Água pura e de qualidade para você e sua família.
                <br>
                Entrega rápida e preços especiais.
            </p> -->
        </section>

        <section class="products-filters">
            <form method="GET" action="">
                <input type="text" name="search" placeholder="Buscar produtos..." id="searchInput" class="form-control"
                    value="{{ search_query }}">
                {% if category_filter %}
                <input type="hidden" name="category" value="{{ category_filter }}">
                {% endif %}
            </form>
            <form method="GET" action="">
                {% if search_query %}
                <input type="hidden" name="search" value="{{ search_query }}">
                {% endif %}
                <select id="categoryFilter" name="category" class="form-control" onchange="this.form.submit()">
                    <option value="">Todas as Categorias</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {% if category_filter|stringformat:"s" == category.id|stringformat:"s" %}selected{% endif %}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </section>

        <!-- Products Grid -->
        <section class="products-grid" id="productsGrid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                    {% else %}
                    <img src="https://via.placeholder.com/200x200?text=Sem+Imagem" alt="{{ product.name }}"
                        loading="lazy">
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <p class="product-category">{{ product.category.name }}</p>
                    <p class="product-price">R$&nbsp;{{ product.price|floatformat:2 }}</p>
                    <button type="button" class="add-btn btn btn-primary btn-sm mt-2"
                        data-product-id="{{ product.pk }}">
                        Adicionar ao Carrinho
                    </button>
                </div>
            </div>
            {% empty %}
            <p>Nenhum produto disponível.</p>
            {% endfor %}
        </section>

        <!-- Pagination -->
        {% include 'components/pagination.html' with page_obj=page_obj search_query=search_query category_filter=category_filter %}

        <!-- Contact Section -->
        <section class="contact-section">
            <h3>Faça seu Pedido Agora!</h3>
            <p>Entre em contato conosco {% if global_info.company_contacts|length > 1 %}pelos telefones abaixo{% else %}pelo telefone abaixo{% endif %} ou adicione os produtos ao carrinho</p>
            <div class="contact-phones">
                {% if global_info.company_contacts|length > 0 %}
                    {% for contact in global_info.company_contacts %}
                        <span class="phone">{{ contact }}</span>
                        {% if not forloop.last and global_info.company_contacts|length > 1 %}
                            <span class="separator">•</span>
                        {% endif %}
                    {% endfor %}
                {% else %}
                    <span class="phone">Nenhum contato disponível</span>
                {% endif %}
            </div>
        </section>
    </div>
</main>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <i data-lucide="check-circle"></i>
        <div class="toast-text">
            <strong id="toastTitle">Produto adicionado!</strong>
            <p id="toastDescription">Item foi adicionado ao seu carrinho.</p>
        </div>
    </div>
</div>

{% compress js %}
<script src="{% static 'components/pagination/pagination.js' %}"></script>
<script src="{% static '/products/script.js' %}"></script>
<script src="{% static '/products/filterProductsByName.js' %}"></script>
{% endcompress %}
<script>
    // Initialize pagination smooth scroll for products section
    initializePaginationScroll('.products-grid');
</script>
{% endblock %}