{% extends 'base.html' %}
{% load static %}
{% block title %}Produtos{% endblock %}
{% block head %}
<link rel="stylesheet" href="{% static 'products/styles.css' %}">
<link rel="stylesheet" href="{% static 'global/buttons-default-style.css' %}">
{% endblock %}
{% block content %}
<main class="main-content">
    <div class="container">
        <!-- Hero Section -->
        <section class="hero-section">
            <h2>Nossos Produtos</h2>
            <p>
                Água pura e de qualidade para você e sua família.
                <br>
                Entrega rápida e preços especiais.
            </p>
        </section>

        <section class="products-filters">
            <form method="GET" action="">
                <input type="text" name="search" placeholder="Buscar produtos..." id="searchInput" class="form-control"
                    value="{{ search_query }}">
            </form>
        </section>

        <!-- Products Grid -->
        <section class="products-grid" id="productsGrid">
            {% for product in products %}
            <div class="product-card">
                <div class="product-image">
                    {% if product.image %}
                    <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy">
                    {% else %}
                    <img src="https://via.placeholder.com/200x200?text=Sem+Imagem" alt="{{ product.name }}"
                        loading="lazy">
                    {% endif %}
                </div>
                <div class="product-info">
                    <h3 class="product-name">{{ product.name }}</h3>
                    <p class="product-price">R$&nbsp;{{ product.price|floatformat:2 }}</p>
                    <button type="button" class="add-btn btn btn-primary btn-sm mt-2"
                        data-product-id="{{ product.pk }}">
                        Adicionar ao Carrinho
                    </button>
                </div>
            </div>
            {% empty %}
            <p>Nenhum produto disponível.</p>
            {% endfor %}
        </section>

        <!-- Pagination -->
        {% if is_paginated %}
        <section class="pagination-section">
            <div class="pagination-wrapper">
                <nav aria-label="Navegação de páginas">
                    <ul class="pagination">
                        <!-- Primeira página -->
                        {% if page_obj.has_previous %}
                        <li class="page-item">
                            <a class="page-link"
                                href="?page=1{% if search_query %}&search={{ search_query }}{% endif %}"
                                aria-label="Primeira página">
                                <span aria-hidden="true">&laquo;&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item">
                            <a class="page-link"
                                href="?page={{ page_obj.previous_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                                aria-label="Página anterior">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        {% else %}
                        <li class="page-item disabled">
                            <span class="page-link" aria-hidden="true">&laquo;&laquo;</span>
                        </li>
                        <li class="page-item disabled">
                            <span class="page-link" aria-hidden="true">&laquo;</span>
                        </li>
                        {% endif %}

                        <!-- Páginas numeradas -->
                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %} 
                            <li
                                class="page-item">
                                <a class="page-link"
                                    href="?page={{ num }}{% if search_query %}&search={{ search_query }}{% endif %}">
                                    {{ num }}
                                </a>
                            </li>
                            {% endif %}
                            {% endfor %}

                            <!-- Última página -->
                            {% if page_obj.has_next %}
                            <li class="page-item">
                                <a class="page-link"
                                    href="?page={{ page_obj.next_page_number }}{% if search_query %}&search={{ search_query }}{% endif %}"
                                    aria-label="Próxima página">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                            <li class="page-item">
                                <a class="page-link"
                                    href="?page={{ page_obj.paginator.num_pages }}{% if search_query %}&search={{ search_query }}{% endif %}"
                                    aria-label="Última página">
                                    <span aria-hidden="true">&raquo;&raquo;</span>
                                </a>
                            </li>
                            {% else %}
                            <li class="page-item disabled">
                                <span class="page-link" aria-hidden="true">&raquo;</span>
                            </li>
                            <li class="page-item disabled">
                                <span class="page-link" aria-hidden="true">&raquo;&raquo;</span>
                            </li>
                            {% endif %}
                    </ul>
                </nav>

                <!-- Informações da paginação -->
                <div class="pagination-info">
                    <p>
                        Mostrando {{ page_obj.start_index }} a {{ page_obj.end_index }}
                        de {{ page_obj.paginator.count }} produtos
                    </p>
                </div>
            </div>
        </section>
        {% endif %}

        <!-- Contact Section -->
        <section class="contact-section">
            <h3>Faça seu Pedido Agora!</h3>
            <p>Entre em contato conosco pelos telefones abaixo ou adicione os produtos ao carrinho</p>
            <div class="contact-phones">
                <span class="phone">(85) 99233-8103</span>
                <span class="separator">•</span>
                <span class="phone">(85) 99169-0986</span>
            </div>
        </section>
    </div>
</main>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <i data-lucide="check-circle"></i>
        <div class="toast-text">
            <strong id="toastTitle">Produto adicionado!</strong>
            <p id="toastDescription">Item foi adicionado ao seu carrinho.</p>
        </div>
    </div>
</div>

<script src="{% static '/products/script.js' %}"></script>
<script src="{% static '/products/filterProductsByName.js' %}"></script>
{% endblock %}